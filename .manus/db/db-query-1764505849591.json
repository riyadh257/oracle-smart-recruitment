{
  "query": "-- Add monitoring system tables\n\nCREATE TABLE IF NOT EXISTS `system_health_checks` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `check_type` enum('database_connection','api_endpoint','resource_utilization','disk_space','memory_usage','cpu_usage') NOT NULL,\n  `check_name` varchar(255) NOT NULL,\n  `status` enum('healthy','degraded','unhealthy') NOT NULL,\n  `response_time` int,\n  `error_message` text,\n  `metadata` json,\n  `checked_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_performance_baselines` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `endpoint_name` varchar(255) NOT NULL,\n  `endpoint_path` varchar(500) NOT NULL,\n  `method` enum('GET','POST','PUT','DELETE','PATCH') NOT NULL,\n  `baseline_response_time` int NOT NULL,\n  `p50_response_time` int NOT NULL,\n  `p95_response_time` int NOT NULL,\n  `p99_response_time` int NOT NULL,\n  `sample_count` int NOT NULL,\n  `captured_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `is_active` boolean DEFAULT true,\n  `metadata` json\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_alert_rules` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `rule_name` varchar(255) NOT NULL,\n  `alert_type` enum('health_check_failure','performance_degradation','resource_threshold','endpoint_error_rate','response_time_spike') NOT NULL,\n  `target_resource` varchar(255) NOT NULL,\n  `threshold_value` int NOT NULL,\n  `threshold_unit` varchar(50) NOT NULL,\n  `comparison_operator` enum('greater_than','less_than','equals') NOT NULL,\n  `consecutive_failures` int DEFAULT 1,\n  `severity` enum('info','warning','critical') NOT NULL DEFAULT 'warning',\n  `is_active` boolean DEFAULT true,\n  `notification_emails` json,\n  `notify_in_app` boolean DEFAULT true,\n  `notify_email` boolean DEFAULT false,\n  `created_by` int NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_alert_history` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `rule_id` int NOT NULL,\n  `alert_type` varchar(100) NOT NULL,\n  `target_resource` varchar(255) NOT NULL,\n  `message` text NOT NULL,\n  `severity` enum('info','warning','critical') NOT NULL,\n  `current_value` int,\n  `threshold_value` int,\n  `acknowledged` boolean DEFAULT false,\n  `acknowledged_by` int,\n  `acknowledged_at` timestamp,\n  `resolved_at` timestamp,\n  `triggered_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX IF NOT EXISTS idx_health_checks_type ON system_health_checks(check_type, checked_at);\nCREATE INDEX IF NOT EXISTS idx_health_checks_status ON system_health_checks(status, checked_at);\nCREATE INDEX IF NOT EXISTS idx_baselines_endpoint ON monitoring_performance_baselines(endpoint_path, is_active);\nCREATE INDEX IF NOT EXISTS idx_alert_rules_active ON monitoring_alert_rules(is_active, alert_type);\nCREATE INDEX IF NOT EXISTS idx_alert_history_rule ON monitoring_alert_history(rule_id, triggered_at);\nCREATE INDEX IF NOT EXISTS idx_alert_history_acknowledged ON monitoring_alert_history(acknowledged, severity);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3HwZw1vuDqLodBY.root --database hjcHA4SjAwhM6aP28vcAkH --execute -- Add monitoring system tables\n\nCREATE TABLE IF NOT EXISTS `system_health_checks` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `check_type` enum('database_connection','api_endpoint','resource_utilization','disk_space','memory_usage','cpu_usage') NOT NULL,\n  `check_name` varchar(255) NOT NULL,\n  `status` enum('healthy','degraded','unhealthy') NOT NULL,\n  `response_time` int,\n  `error_message` text,\n  `metadata` json,\n  `checked_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_performance_baselines` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `endpoint_name` varchar(255) NOT NULL,\n  `endpoint_path` varchar(500) NOT NULL,\n  `method` enum('GET','POST','PUT','DELETE','PATCH') NOT NULL,\n  `baseline_response_time` int NOT NULL,\n  `p50_response_time` int NOT NULL,\n  `p95_response_time` int NOT NULL,\n  `p99_response_time` int NOT NULL,\n  `sample_count` int NOT NULL,\n  `captured_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `is_active` boolean DEFAULT true,\n  `metadata` json\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_alert_rules` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `rule_name` varchar(255) NOT NULL,\n  `alert_type` enum('health_check_failure','performance_degradation','resource_threshold','endpoint_error_rate','response_time_spike') NOT NULL,\n  `target_resource` varchar(255) NOT NULL,\n  `threshold_value` int NOT NULL,\n  `threshold_unit` varchar(50) NOT NULL,\n  `comparison_operator` enum('greater_than','less_than','equals') NOT NULL,\n  `consecutive_failures` int DEFAULT 1,\n  `severity` enum('info','warning','critical') NOT NULL DEFAULT 'warning',\n  `is_active` boolean DEFAULT true,\n  `notification_emails` json,\n  `notify_in_app` boolean DEFAULT true,\n  `notify_email` boolean DEFAULT false,\n  `created_by` int NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `monitoring_alert_history` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `rule_id` int NOT NULL,\n  `alert_type` varchar(100) NOT NULL,\n  `target_resource` varchar(255) NOT NULL,\n  `message` text NOT NULL,\n  `severity` enum('info','warning','critical') NOT NULL,\n  `current_value` int,\n  `threshold_value` int,\n  `acknowledged` boolean DEFAULT false,\n  `acknowledged_by` int,\n  `acknowledged_at` timestamp,\n  `resolved_at` timestamp,\n  `triggered_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX IF NOT EXISTS idx_health_checks_type ON system_health_checks(check_type, checked_at);\nCREATE INDEX IF NOT EXISTS idx_health_checks_status ON system_health_checks(status, checked_at);\nCREATE INDEX IF NOT EXISTS idx_baselines_endpoint ON monitoring_performance_baselines(endpoint_path, is_active);\nCREATE INDEX IF NOT EXISTS idx_alert_rules_active ON monitoring_alert_rules(is_active, alert_type);\nCREATE INDEX IF NOT EXISTS idx_alert_history_rule ON monitoring_alert_history(rule_id, triggered_at);\nCREATE INDEX IF NOT EXISTS idx_alert_history_acknowledged ON monitoring_alert_history(acknowledged, severity);",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 6728
}