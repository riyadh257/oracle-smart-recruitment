{
  "query": "\nCREATE TABLE IF NOT EXISTS alert_escalation_rules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  rule_name VARCHAR(255) NOT NULL,\n  alert_type VARCHAR(100) NOT NULL,\n  severity ENUM('critical', 'high', 'medium', 'low', 'info', 'warning', 'urgent') NOT NULL,\n  escalation_levels JSON NOT NULL,\n  is_active BOOLEAN DEFAULT TRUE,\n  applies_to_rule_ids JSON,\n  created_by INT NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_alert_type (alert_type),\n  INDEX idx_severity (severity),\n  INDEX idx_active (is_active)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS alert_escalation_history (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  alert_id INT NOT NULL,\n  escalation_rule_id INT NOT NULL,\n  current_level INT NOT NULL DEFAULT 1,\n  max_level INT NOT NULL,\n  escalation_status ENUM('pending', 'in_progress', 'completed', 'cancelled', 'resolved') DEFAULT 'pending' NOT NULL,\n  alert_triggered_at TIMESTAMP NOT NULL,\n  last_escalated_at TIMESTAMP NULL,\n  next_escalation_at TIMESTAMP NULL,\n  resolved_at TIMESTAMP NULL,\n  resolved_by INT NULL,\n  resolution_notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_alert_id (alert_id),\n  INDEX idx_status (escalation_status),\n  INDEX idx_next_escalation (next_escalation_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS escalation_notifications (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  escalation_history_id INT NOT NULL,\n  escalation_level INT NOT NULL,\n  notification_type ENUM('email', 'in_app', 'sms', 'webhook') NOT NULL,\n  recipient_user_id INT NULL,\n  recipient_email VARCHAR(320) NULL,\n  recipient_role VARCHAR(50) NULL,\n  subject VARCHAR(500),\n  message TEXT NOT NULL,\n  sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  delivery_status ENUM('sent', 'delivered', 'failed', 'bounced') DEFAULT 'sent' NOT NULL,\n  error_message TEXT,\n  INDEX idx_escalation_history (escalation_history_id),\n  INDEX idx_recipient_user (recipient_user_id),\n  INDEX idx_sent_at (sent_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_report_schedules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  schedule_name VARCHAR(255) NOT NULL,\n  report_type ENUM('saudization_compliance', 'nitaqat_status', 'gosi_verification', 'qiwa_sync', 'comprehensive_compliance') NOT NULL,\n  frequency ENUM('daily', 'weekly', 'monthly', 'quarterly') NOT NULL DEFAULT 'monthly',\n  day_of_week INT NULL,\n  day_of_month INT NULL,\n  time_of_day VARCHAR(8) DEFAULT '09:00:00',\n  recipient_emails JSON NOT NULL,\n  recipient_user_ids JSON,\n  stakeholder_groups JSON,\n  include_trends BOOLEAN DEFAULT TRUE,\n  include_recommendations BOOLEAN DEFAULT TRUE,\n  include_predictions BOOLEAN DEFAULT FALSE,\n  lookback_months INT DEFAULT 3,\n  template_id INT NULL,\n  custom_sections JSON,\n  is_active BOOLEAN DEFAULT TRUE,\n  last_run_at TIMESTAMP NULL,\n  next_run_at TIMESTAMP NULL,\n  created_by INT NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_active (is_active),\n  INDEX idx_next_run (next_run_at),\n  INDEX idx_report_type (report_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_report_deliveries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  schedule_id INT NULL,\n  report_type VARCHAR(100) NOT NULL,\n  report_title VARCHAR(255) NOT NULL,\n  report_period_start TIMESTAMP NOT NULL,\n  report_period_end TIMESTAMP NOT NULL,\n  file_key VARCHAR(500) NOT NULL,\n  file_url VARCHAR(1000) NOT NULL,\n  file_size INT NULL,\n  total_alerts INT DEFAULT 0,\n  critical_alerts INT DEFAULT 0,\n  compliance_score INT NULL,\n  key_findings JSON,\n  recommendations JSON,\n  sent_to_emails JSON,\n  sent_to_users JSON,\n  delivery_status ENUM('generated', 'sent', 'failed') DEFAULT 'generated' NOT NULL,\n  delivery_error TEXT,\n  generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  sent_at TIMESTAMP NULL,\n  generated_by INT NULL,\n  INDEX idx_schedule (schedule_id),\n  INDEX idx_report_type (report_type),\n  INDEX idx_generated_at (generated_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_metrics_snapshots (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  snapshot_date TIMESTAMP NOT NULL,\n  snapshot_type ENUM('daily', 'weekly', 'monthly') NOT NULL,\n  saudization_rate INT NULL,\n  nitaqat_color ENUM('platinum', 'green', 'yellow', 'red') NULL,\n  saudi_employee_count INT NULL,\n  total_employee_count INT NULL,\n  female_saudi_count INT NULL,\n  disabled_count INT NULL,\n  overall_compliance_score INT NULL,\n  gosi_compliance_score INT NULL,\n  qiwa_compliance_score INT NULL,\n  nitaqat_compliance_score INT NULL,\n  active_alerts_count INT DEFAULT 0,\n  critical_alerts_count INT DEFAULT 0,\n  unresolved_alerts_count INT DEFAULT 0,\n  avg_resolution_time_hours INT NULL,\n  saudization_trend ENUM('improving', 'stable', 'declining') NULL,\n  compliance_trend ENUM('improving', 'stable', 'declining') NULL,\n  risk_level ENUM('low', 'medium', 'high', 'critical') NULL,\n  predicted_next_month_rate INT NULL,\n  predicted_risk_level ENUM('low', 'medium', 'high', 'critical') NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_snapshot (snapshot_date, snapshot_type),\n  INDEX idx_snapshot_date (snapshot_date),\n  INDEX idx_snapshot_type (snapshot_type),\n  INDEX idx_risk_level (risk_level)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_trend_analysis (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  analysis_date TIMESTAMP NOT NULL,\n  metric_type VARCHAR(100) NOT NULL,\n  historical_values JSON NOT NULL,\n  trend_direction ENUM('up', 'down', 'stable') NOT NULL,\n  trend_strength INT NULL,\n  mean_value INT NULL,\n  std_deviation INT NULL,\n  min_value INT NULL,\n  max_value INT NULL,\n  forecast_next_month INT NULL,\n  forecast_next_quarter INT NULL,\n  forecast_confidence INT NULL,\n  has_anomalies BOOLEAN DEFAULT FALSE,\n  anomaly_dates JSON,\n  anomaly_description TEXT,\n  recommended_actions JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_analysis (analysis_date, metric_type),\n  INDEX idx_analysis_date (analysis_date),\n  INDEX idx_metric_type (metric_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_violation_predictions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  prediction_date TIMESTAMP NOT NULL,\n  violation_type VARCHAR(100) NOT NULL,\n  risk_score INT NOT NULL,\n  risk_level ENUM('low', 'medium', 'high', 'critical') NOT NULL,\n  probability INT NOT NULL,\n  estimated_occurrence_date TIMESTAMP NULL,\n  days_until_violation INT NULL,\n  contributing_factors JSON,\n  current_metrics JSON,\n  threshold_metrics JSON,\n  preventive_actions JSON,\n  estimated_impact_if_prevented INT NULL,\n  status ENUM('predicted', 'monitoring', 'prevented', 'occurred', 'false_positive') DEFAULT 'predicted' NOT NULL,\n  actual_outcome TEXT,\n  outcome_date TIMESTAMP NULL,\n  model_version VARCHAR(50),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_prediction_date (prediction_date),\n  INDEX idx_risk_level (risk_level),\n  INDEX idx_status (status),\n  INDEX idx_occurrence_date (estimated_occurrence_date)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3HwZw1vuDqLodBY.root --database hjcHA4SjAwhM6aP28vcAkH --execute \nCREATE TABLE IF NOT EXISTS alert_escalation_rules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  rule_name VARCHAR(255) NOT NULL,\n  alert_type VARCHAR(100) NOT NULL,\n  severity ENUM('critical', 'high', 'medium', 'low', 'info', 'warning', 'urgent') NOT NULL,\n  escalation_levels JSON NOT NULL,\n  is_active BOOLEAN DEFAULT TRUE,\n  applies_to_rule_ids JSON,\n  created_by INT NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_alert_type (alert_type),\n  INDEX idx_severity (severity),\n  INDEX idx_active (is_active)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS alert_escalation_history (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  alert_id INT NOT NULL,\n  escalation_rule_id INT NOT NULL,\n  current_level INT NOT NULL DEFAULT 1,\n  max_level INT NOT NULL,\n  escalation_status ENUM('pending', 'in_progress', 'completed', 'cancelled', 'resolved') DEFAULT 'pending' NOT NULL,\n  alert_triggered_at TIMESTAMP NOT NULL,\n  last_escalated_at TIMESTAMP NULL,\n  next_escalation_at TIMESTAMP NULL,\n  resolved_at TIMESTAMP NULL,\n  resolved_by INT NULL,\n  resolution_notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_alert_id (alert_id),\n  INDEX idx_status (escalation_status),\n  INDEX idx_next_escalation (next_escalation_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS escalation_notifications (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  escalation_history_id INT NOT NULL,\n  escalation_level INT NOT NULL,\n  notification_type ENUM('email', 'in_app', 'sms', 'webhook') NOT NULL,\n  recipient_user_id INT NULL,\n  recipient_email VARCHAR(320) NULL,\n  recipient_role VARCHAR(50) NULL,\n  subject VARCHAR(500),\n  message TEXT NOT NULL,\n  sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  delivery_status ENUM('sent', 'delivered', 'failed', 'bounced') DEFAULT 'sent' NOT NULL,\n  error_message TEXT,\n  INDEX idx_escalation_history (escalation_history_id),\n  INDEX idx_recipient_user (recipient_user_id),\n  INDEX idx_sent_at (sent_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_report_schedules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  schedule_name VARCHAR(255) NOT NULL,\n  report_type ENUM('saudization_compliance', 'nitaqat_status', 'gosi_verification', 'qiwa_sync', 'comprehensive_compliance') NOT NULL,\n  frequency ENUM('daily', 'weekly', 'monthly', 'quarterly') NOT NULL DEFAULT 'monthly',\n  day_of_week INT NULL,\n  day_of_month INT NULL,\n  time_of_day VARCHAR(8) DEFAULT '09:00:00',\n  recipient_emails JSON NOT NULL,\n  recipient_user_ids JSON,\n  stakeholder_groups JSON,\n  include_trends BOOLEAN DEFAULT TRUE,\n  include_recommendations BOOLEAN DEFAULT TRUE,\n  include_predictions BOOLEAN DEFAULT FALSE,\n  lookback_months INT DEFAULT 3,\n  template_id INT NULL,\n  custom_sections JSON,\n  is_active BOOLEAN DEFAULT TRUE,\n  last_run_at TIMESTAMP NULL,\n  next_run_at TIMESTAMP NULL,\n  created_by INT NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_active (is_active),\n  INDEX idx_next_run (next_run_at),\n  INDEX idx_report_type (report_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_report_deliveries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  schedule_id INT NULL,\n  report_type VARCHAR(100) NOT NULL,\n  report_title VARCHAR(255) NOT NULL,\n  report_period_start TIMESTAMP NOT NULL,\n  report_period_end TIMESTAMP NOT NULL,\n  file_key VARCHAR(500) NOT NULL,\n  file_url VARCHAR(1000) NOT NULL,\n  file_size INT NULL,\n  total_alerts INT DEFAULT 0,\n  critical_alerts INT DEFAULT 0,\n  compliance_score INT NULL,\n  key_findings JSON,\n  recommendations JSON,\n  sent_to_emails JSON,\n  sent_to_users JSON,\n  delivery_status ENUM('generated', 'sent', 'failed') DEFAULT 'generated' NOT NULL,\n  delivery_error TEXT,\n  generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  sent_at TIMESTAMP NULL,\n  generated_by INT NULL,\n  INDEX idx_schedule (schedule_id),\n  INDEX idx_report_type (report_type),\n  INDEX idx_generated_at (generated_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_metrics_snapshots (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  snapshot_date TIMESTAMP NOT NULL,\n  snapshot_type ENUM('daily', 'weekly', 'monthly') NOT NULL,\n  saudization_rate INT NULL,\n  nitaqat_color ENUM('platinum', 'green', 'yellow', 'red') NULL,\n  saudi_employee_count INT NULL,\n  total_employee_count INT NULL,\n  female_saudi_count INT NULL,\n  disabled_count INT NULL,\n  overall_compliance_score INT NULL,\n  gosi_compliance_score INT NULL,\n  qiwa_compliance_score INT NULL,\n  nitaqat_compliance_score INT NULL,\n  active_alerts_count INT DEFAULT 0,\n  critical_alerts_count INT DEFAULT 0,\n  unresolved_alerts_count INT DEFAULT 0,\n  avg_resolution_time_hours INT NULL,\n  saudization_trend ENUM('improving', 'stable', 'declining') NULL,\n  compliance_trend ENUM('improving', 'stable', 'declining') NULL,\n  risk_level ENUM('low', 'medium', 'high', 'critical') NULL,\n  predicted_next_month_rate INT NULL,\n  predicted_risk_level ENUM('low', 'medium', 'high', 'critical') NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_snapshot (snapshot_date, snapshot_type),\n  INDEX idx_snapshot_date (snapshot_date),\n  INDEX idx_snapshot_type (snapshot_type),\n  INDEX idx_risk_level (risk_level)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_trend_analysis (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  analysis_date TIMESTAMP NOT NULL,\n  metric_type VARCHAR(100) NOT NULL,\n  historical_values JSON NOT NULL,\n  trend_direction ENUM('up', 'down', 'stable') NOT NULL,\n  trend_strength INT NULL,\n  mean_value INT NULL,\n  std_deviation INT NULL,\n  min_value INT NULL,\n  max_value INT NULL,\n  forecast_next_month INT NULL,\n  forecast_next_quarter INT NULL,\n  forecast_confidence INT NULL,\n  has_anomalies BOOLEAN DEFAULT FALSE,\n  anomaly_dates JSON,\n  anomaly_description TEXT,\n  recommended_actions JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_analysis (analysis_date, metric_type),\n  INDEX idx_analysis_date (analysis_date),\n  INDEX idx_metric_type (metric_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\nCREATE TABLE IF NOT EXISTS compliance_violation_predictions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  prediction_date TIMESTAMP NOT NULL,\n  violation_type VARCHAR(100) NOT NULL,\n  risk_score INT NOT NULL,\n  risk_level ENUM('low', 'medium', 'high', 'critical') NOT NULL,\n  probability INT NOT NULL,\n  estimated_occurrence_date TIMESTAMP NULL,\n  days_until_violation INT NULL,\n  contributing_factors JSON,\n  current_metrics JSON,\n  threshold_metrics JSON,\n  preventive_actions JSON,\n  estimated_impact_if_prevented INT NULL,\n  status ENUM('predicted', 'monitoring', 'prevented', 'occurred', 'false_positive') DEFAULT 'predicted' NOT NULL,\n  actual_outcome TEXT,\n  outcome_date TIMESTAMP NULL,\n  model_version VARCHAR(50),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_prediction_date (prediction_date),\n  INDEX idx_risk_level (risk_level),\n  INDEX idx_status (status),\n  INDEX idx_occurrence_date (estimated_occurrence_date)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 4123
}